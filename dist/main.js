!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e){return Object.keys(e).some(function(t){var r=e[t];if(!r)return!1;switch(r.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}})}function i(e){var t={};return Object.keys(e).forEach(function(r){var n=e[r];if(n||0===n||"boolean"==typeof n||"string"==typeof n){var o;switch(n.constructor.name){case"Array":o=n[0]&&n[0].constructor&&"Object"===n[0].constructor.name?JSON.stringify(n):n.join(",");break;case"Object":o=JSON.stringify(n);break;case"Date":o=n.valueOf();break;case"Function":o=null;break;case"Boolean":o=n+"";break;default:o=n}(o||0===o||"string"==typeof o)&&(t[r]=o)}}),t}function a(e){var t=i(e);return Object.keys(t).map(function(e){return function(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}(e,t[e])}).join("&")}var u=function(){return function(e,t,r,n,o){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=o}}();u.prototype=Object.create(Error.prototype),u.prototype.constructor=u;var h="@esri/arcgis-rest-js";function c(e,t){void 0===t&&(t={params:{f:"json"}});var r=o({httpMethod:"POST"},t),n=[],c=[];if(r.fetch||"undefined"==typeof fetch?(n.push("`fetch`"),c.push("`isomorphic-fetch`")):r.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(n.push("`Promise`"),c.push("`es6-promise`")),"undefined"==typeof FormData&&(n.push("`FormData`"),c.push("`isomorphic-form-data`")),!r.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires global variables for `fetch`, `Promise` and `FormData` to be present in the global scope. You are missing "+n.join(", ")+". We recommend installing the "+c.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var p=r.httpMethod,l=r.authentication,d=o({f:"json"},t.params),k={method:p,credentials:"same-origin"};return(l?l.getToken(e,{fetch:r.fetch}):Promise.resolve("")).then(function(n){if(n.length&&(d.token=n),"GET"===k.method){var u=""===a(d)?e:e+"?"+a(d);r.maxUrlLength&&u.length>r.maxUrlLength?k.method="POST":e=u}return"POST"===k.method&&(k.body=function(e){var t=s(e),r=i(e);if(t){var n=new FormData;return Object.keys(r).forEach(function(e){if("undefined"!=typeof Blob&&r[e]instanceof Blob){var t=r.fileName||r[e].name||e;n.append(e,r[e],t)}else n.append(e,r[e])}),n}return a(e)}(d)),k.headers=o({},t.headers),"undefined"!=typeof window||k.headers.referer||(k.headers.referer=h),s(d)||(k.headers["Content-Type"]="application/x-www-form-urlencoded"),r.fetch(e,k)}).then(function(t){if(!t.ok){var n=t.status,o=t.statusText;throw new u(o,"HTTP "+n,t,e,r)}switch(d.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}}).then(function(t){return"json"===d.f||"geojson"===d.f?function(e,t,r,n){if(e.code>=400){var o=e.message,s=e.code;throw new u(o,s,e,t,n)}if(e.error){var i=e.error,o=i.message,s=i.code,a=i.messageCode,h=a||s||"UNKNOWN_ERROR_CODE";if(498===s||499===s||"GWM_0003"===a)throw new f(o,h,e,t,n);throw new u(o,h,e,t,n)}if("failed"===e.status||"failure"===e.status){var o=void 0,s="UNKNOWN_ERROR_CODE";try{o=JSON.parse(e.statusMessage).message,s=JSON.parse(e.statusMessage).code}catch(t){o=e.statusMessage||e.message}throw new u(o,s,e,t,n)}return e}(t,e,0,r):t})}var p,f=function(e){function t(t,r,n,o,s){void 0===t&&(t="AUTHENTICATION_ERROR"),void 0===r&&(r="AUTHENTICATION_ERROR_CODE");var i=e.call(this,t,r,n,o,s)||this;return i.name="ArcGISAuthError",i.message="AUTHENTICATION_ERROR_CODE"===r?t:r+": "+t,i}return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.retry=function(e,t){var r=this;void 0===t&&(t=3);var n=0,s=function(i,a){e(r.url,r.options).then(function(e){var t=o({},r.options,{authentication:e});return n+=1,c(r.url,t)}).then(function(e){i(e)}).catch(function(e){"ArcGISAuthError"===e.name&&n<t?s(i,a):"ArcGISAuthError"===e.name&&n>=t?a(r):a(e)})};return new Promise(function(e,t){s(e,t)})},t}(u);function l(e){return"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}function d(e,t){return c(e,t.params?t:{params:t}).then(function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+(1e3*e.expires_in-1e3)),ssl:!0===e.ssl};return e.refresh_token&&(t.refreshToken=e.refresh_token),t})}!function(e){e.ArcGISRequestError="ArcGISRequestError",e.ArcGISAuthError="ArcGISAuthError"}(p||(p={}));!function(){function e(e){this.clientId=e.clientId,this.clientSecret=e.clientSecret,this.token=e.token,this.expires=e.expires,this.portal=e.portal||"https://www.arcgis.com/sharing/rest",this.duration=e.duration||7200}e.prototype.getToken=function(e,t){return this.token&&this.expires&&this.expires.getTime()>Date.now()?Promise.resolve(this.token):this._pendingTokenRequest?this._pendingTokenRequest:(this._pendingTokenRequest=this.refreshToken(t),this._pendingTokenRequest)},e.prototype.refreshToken=function(e){var t=this,r=o({params:{client_id:this.clientId,client_secret:this.clientSecret,grant_type:"client_credentials",expiration:this.duration}},e);return d(this.portal+"/oauth2/token/",r).then(function(e){return t._pendingTokenRequest=null,t.token=e.token,t.expires=e.expires,e.token})},e.prototype.refreshSession=function(){var e=this;return this.refreshToken().then(function(){return e})}}();function k(e,t){var r=t.params?t:{params:t};return"undefined"!=typeof window&&window.location&&window.location.host?r.params.referer=window.location.host:r.params.referer=h,c(e,r)}!function(){function e(e){this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.username=e.username,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?l(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.refreshTokenTTL=e.refreshTokenTTL||1440,this.trustedServers={},this._pendingTokenRequests={}}e.beginOAuth2=function(t,r){void 0===r&&(r=window);var n,s=o({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",duration:20160,popup:!0,state:t.clientId,locale:""},t),i=s.portal,a=s.provider,u=s.clientId,h=s.duration,c=s.redirectUri,p=s.popup,l=s.state,d=s.locale;if(n="arcgis"===a?i+"/oauth2/authorize?client_id="+u+"&response_type=token&expiration="+h+"&redirect_uri="+encodeURIComponent(c)+"&state="+l+"&locale="+d:i+"/oauth2/social/authorize?client_id="+u+"&socialLoginProviderName="+a+"&autoAccountCreateForSocial=true&response_type=token&expiration="+h+"&redirect_uri="+encodeURIComponent(c)+"&state="+l+"&locale="+d,p){var k,m=((k={promise:null,resolve:null,reject:null}).promise=new Promise(function(e,t){k.resolve=e,k.reject=t}),k);return r["__ESRI_REST_AUTH_HANDLER_"+u]=function(t,r){if(t){var n=JSON.parse(t);m.reject(new f(n.errorMessage,n.error))}else if(r){var o=JSON.parse(r);m.resolve(new e({clientId:u,portal:i,ssl:o.ssl,token:o.token,tokenExpires:new Date(o.expires),username:o.username}))}},r.open(n,"oauth-window","height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes"),m.promise}r.location.href=n},e.completeOAuth2=function(t,r){void 0===r&&(r=window);var n=o({portal:"https://www.arcgis.com/sharing/rest"},t),s=n.portal,i=n.clientId;function a(t,n){if(r.opener&&r.opener.parent)return r.opener.parent["__ESRI_REST_AUTH_HANDLER_"+i](t?JSON.stringify(t):void 0,JSON.stringify(n)),void r.close();if(r!==r.parent)return r.parent["__ESRI_REST_AUTH_HANDLER_"+i](t?JSON.stringify(t):void 0,JSON.stringify(n)),void r.close();if(t)throw new f(t.errorMessage,t.error);return new e({clientId:i,portal:s,ssl:n.ssl,token:n.token,tokenExpires:n.expires,username:n.username})}var u=r.location.href.match(/access_token=(.+)&expires_in=(.+)&username=([^&]+)/);if(!u){var h=r.location.href.match(/error=(.+)&error_description=(.+)/);return a({error:h[1],errorMessage:decodeURIComponent(h[2])})}var c=u[1],p=new Date(Date.now()+1e3*parseInt(u[2],10)-6e4),l=decodeURIComponent(u[3]);return a(void 0,{token:c,expires:p,ssl:r.location.href.indexOf("&ssl=true")>-1||r.location.href.indexOf("#ssl=true")>-1,username:l})},e.authorize=function(e,t){var r=o({portal:"https://arcgis.com/sharing/rest",duration:20160},e),n=r.portal,s=r.clientId,i=r.duration,a=r.redirectUri;t.writeHead(301,{Location:n+"/oauth2/authorize?client_id="+s+"&duration="+i+"&response_type=code&redirect_uri="+encodeURIComponent(a)}),t.end()},e.exchangeAuthorizationCode=function(t,r){var n=o({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:1440},t),s=n.portal,i=n.clientId,a=n.redirectUri,u=n.refreshTokenTTL;return d(s+"/oauth2/token",{grant_type:"authorization_code",client_id:i,redirect_uri:a,code:r}).then(function(t){return new e({clientId:i,portal:s,ssl:t.ssl,redirectUri:a,refreshToken:t.refreshToken,refreshTokenTTL:u,refreshTokenExpires:new Date(Date.now()+1e3*(u-1)),token:t.token,tokenExpires:t.expires,username:t.username})})},e.deserialize=function(t){var r=JSON.parse(t);return new e({clientId:r.clientId,refreshToken:r.refreshToken,refreshTokenExpires:new Date(r.refreshTokenExpires),username:r.username,password:r.password,token:r.token,tokenExpires:new Date(r.tokenExpires),portal:r.portal,ssl:r.ssl,tokenDuration:r.tokenDuration,redirectUri:r.redirectUri,refreshTokenTTL:r.refreshTokenTTL})},e.fromCredential=function(t){return new e({portal:t.server.includes("sharing/rest")?t.server:t.server+"/sharing/rest",ssl:t.ssl,token:t.token,username:t.userId,tokenExpires:new Date(t.expires)})},Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:!0,configurable:!0}),e.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}},e.prototype.getUser=function(e){var t=this;return this._user&&this._user.username===this.username?Promise.resolve(this._user):c(this.portal+"/community/users/"+encodeURIComponent(this.username),o({httpMethod:"GET",authentication:this},e)).then(function(e){return t._user=e,e})},e.prototype.getToken=function(e,t){return/^https?:\/\/\S+\.arcgis\.com\/sharing\/rest/.test(this.portal)&&/^https?:\/\/\S+\.arcgis\.com.+/.test(e)?this.getFreshToken(t):new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t)},e.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}},e.prototype.serialize=function(){return JSON.stringify(this)},e.prototype.refreshSession=function(e){return this._user=null,this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new f("Unable to refresh token."))},e.prototype.getTokenForServer=function(e,t){var r=this,n=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0],o=this.trustedServers[n];return o&&o.expires.getTime()>Date.now()?Promise.resolve(o.token):this._pendingTokenRequests[n]?this._pendingTokenRequests[n]:(this._pendingTokenRequests[n]=c(n+"/rest/info").then(function(e){return e.owningSystemUrl}).then(function(n){if(!n||!new RegExp(n,"i").test(r.portal))throw new f(e+" is not federated with "+r.portal+".","NOT_FEDERATED");return c(n+"/sharing/rest/info",t)}).then(function(e){return e.authInfo.tokenServicesUrl}).then(function(t){return r.token?k(t,{params:{token:r.token,serverUrl:e,expiration:r.tokenDuration}}):k(t,{params:{username:r.username,password:r.password,expiration:r.tokenDuration}}).then(function(e){return r._token=e.token,r._tokenExpires=new Date(e.expires),e})}).then(function(e){return r.trustedServers[n]={expires:new Date(e.expires),token:e.token},e.token}),this._pendingTokenRequests[n])},e.prototype.getFreshToken=function(e){var t=this;return this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshSession(e).then(function(e){return t._pendingTokenRequests[t.portal]=null,e.token})),this._pendingTokenRequests[this.portal])},e.prototype.refreshWithUsernameAndPassword=function(e){var t=this,r=o({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},e);return k(this.portal+"/generateToken",r).then(function(e){return t._token=e.token,t._tokenExpires=new Date(e.expires),t})},e.prototype.refreshWithRefreshToken=function(e){var t=this;if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now())return this.refreshRefreshToken(e);var r=o({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return d(this.portal+"/oauth2/token",r).then(function(e){return t._token=e.token,t._tokenExpires=e.expires,t})},e.prototype.refreshRefreshToken=function(e){var t=this,r=o({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return d(this.portal+"/oauth2/token",r).then(function(e){return t._token=e.token,t._tokenExpires=e.expires,t._refreshToken=e.refreshToken,t._refreshTokenExpires=new Date(Date.now()+60*(t.refreshTokenTTL-1)*1e3),t})}}();document.body.appendChild(function(){let e=document.createElement("button");return e.innerHTML="Open in ArcGIS Online",e}())}]);